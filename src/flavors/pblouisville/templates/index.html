{% extends 'base.html' %}
{% load i18n %}

{% block site-title %}
<a href="/">
  <img src="/static/images/Louisville-City-Seal.png">
  {{config.app.title}} <small>PB</small>
</a>

{% endblock %}

{% block meta %}
<link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
<link rel="stylesheet" href="https://use.typekit.net/aha2jwg.css">
  {% if place %}
    <!-- Twitter -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="{{ place.properties.name }}">
    <meta name="twitter:description" content="{{ place.properties.description }}">
    {% with attachment=place.properties.attachments|first %}
    <meta name="twitter:image:src" content="{{ attachment.file }}">
    {% endwith %}
    {% comment %} TODO: Fill this in when we know if the username is from twitter
      <meta name="twitter:creator" content="place.submitter.username">
    {% endcomment %}

    <!-- Facebook -->
    <meta property="og:site_name" content="{{ config.app.title }}" />
    <meta property="og:title" content="{{ place.properties.name }}" />
    <meta property="og:description" content="{{ place.properties.description }}" />
    {% with attachment=place.properties.attachments|first %}
    <meta name="og:image" content="{{ attachment.file }}">
    {% endwith %}
  {% else %}
    <!-- Twitter -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="{{ config.app.title }}">
    <meta name="twitter:description" content="{{ config.app.meta_description }}">

    <!-- Facebook -->
    <meta property="og:site_name" content="{{ config.app.title }}" />
    <meta property="og:title" content="{{ config.app.title }}" />
    <meta property="og:description" content="{{ config.app.meta_description }}" />
  {% endif%}
{% endblock %}

<!--
  This will place content at the top of the side bar
 -->
{% block sidebar %}
{% endblock %}

<!--
  This will place content in the colophon below the map
 -->
{% block colophon %}
<p id="powered-by">{% blocktrans %}Powered by{% endblocktrans %} <a href="http://shareabouts.org/" class="shareabouts-logo" target="_blank">Shareabouts</a>, <span class="nobreak">built by Poe<b>Public</b></span></p>
{% endblock %}

{% block cdn_load %}
<script src='https://api.mapbox.com/mapbox.js/v3.1.1/mapbox.js'></script>
<link href='https://api.mapbox.com/mapbox.js/v3.1.1/mapbox.css' rel='stylesheet' />
{% endblock %}

<!--
  Analytics, custom JS, and such go here
 -->
{% block includes %}
<script>
$(function() {
  L.mapbox.accessToken = 'pk.eyJ1IjoiZGFuYWVtb2JsZXkiLCJhIjoiY2loODJjNDZjMHQ3c3Vta2lmd3k1Mm1iZiJ9.Me79N9SPoQPdl6-U0kIZxg';
  Shareabouts.geocoderControl = L.mapbox.geocoderControl('mapbox.places', {autocomplete: true});
  window.app.appView.mapView.map.addControl(Shareabouts.geocoderControl);
  
  Shareabouts.mapboxToMapQuestResult = function(result) {
    result.latLng = {lat: result.center[1], lng: result.center[0]}

    if (result.center)    delete result.center;
    if (result.relevance) delete result.relevance;
    if (result.address)   delete result.address;
    if (result.context)   delete result.context;
    if (result.bbox)      delete result.bbox;
    if (result.id)        delete result.id;
    if (result.text)      delete result.text;
    if (result.type)      delete result.type;

    return result;
  };

  Shareabouts.mapboxToMapQuestResults = function(data) {
    // Make Mapbox reverse geocode results look kinda like
    // MapQuest results.
    data.results = data.features;
    if (data.results.length > 0) {
      data.results[0] = {locations: [
        Shareabouts.mapboxToMapQuestResult(data.results[0])
      ]};
    }
    return data;
  };

  Shareabouts.geocoderControl.on('select', function(result) {
    result = Shareabouts.mapboxToMapQuestResult(result.feature);
    $(Shareabouts).trigger('reversegeocode', result);
    Shareabouts.geocoderControl._closeIfOpen();
  });

  $(Shareabouts).on('reversegeocode', function() {
    // Shareabouts.geocoderControl._closeIfOpen();
  })
});
</script>
{% endblock %}
